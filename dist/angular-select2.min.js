angular.module("rt.select2",[]).value("select2Config",{}).directive("select2",["$rootScope","$timeout","$parse","select2Config",function(a,b,c,d){"use strict";function e(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b.sort()}var f={},g=/^\s*(.*?)(?:\s+as\s+(.*?))?(?:\s+group\s+by\s+(.*))?\s+for\s+(?:([\$\w][\$\w]*)|(?:\(\s*([\$\w][\$\w]*)\s*,\s*([\$\w][\$\w]*)\s*\)))\s+in\s+(.*?)(?:\s+track\s+by\s+(.*?))?$/;return d&&angular.extend(f,d),{require:"ngModel",priority:1,restrict:"E",template:'<input type="hidden"></input>',replace:!0,link:function(a,d,h,i){function j(a){k(m?function(b){for(var c=[],d=0;d<b.length;d++){var e=b[d],f=i.$viewValue||[];f.indexOf(e.id)>-1&&c.push(e)}a(c)}:function(){a(o[i.$viewValue]||{})})}var k,l=angular.extend({},f,a.$eval(h.options)),m=angular.isDefined(h.multiple)||l.multiple;l.multiple=m,h.placeholder&&(l.placeholder=h.placeholder);var n=c(h.ngModel),o={};if(h.ngOptions){var p;if(!(p=h.ngOptions.match(g)))throw new Error("Invalid ngOptions encountered!");var q=c(p[2]||p[1]),r=c(p[7]),s=p[4]||p[6],t=c(p[2]?p[1]:s),u=p[5];k=function(b){for(var c=r(a),d=(u?e(c):c)||[],f=[],g=0;g<d.length;g++){var h={},i=g;u&&(i=d[g],h[u]=i),h[s]=c[i];var j=t(a,h),k=q(a,h)||"";o[j]={id:j,text:k,obj:c[i]},f.push(o[j])}b(f)},l.query=function(b){for(var c=r(a),d=(u?e(c):c)||[],f=[],g=0;g<d.length;g++){var h={},i=g;u&&(i=d[g],h[u]=i),h[s]=c[i];var j=t(a,h),k=q(a,h)||"";k.toLowerCase().indexOf(b.term.toLowerCase())>-1&&f.push({id:j,text:k,obj:c[i]})}b.callback({results:f})},a.$watch(p[7],function(){i.$render()})}else{if(!l.query)throw new Error("You need to supply a query function!");var v=l.query;l.query=function(a){var b=a.callback;a.callback=function(a){for(var c=0;c<a.results.length;c++){var d=a.results[c];o[d.id]=d}b(a)},v(a)},k=function(a){l.query({term:"",callback:function(b){a(b.results)}})}}i.$render=function(){j(function(a){m?d.select2("data",a):d.select2("val",a.id)})},l.initSelection=function(a,b){j(b)},b(function(){d.select2(l),d.on("change",function(b){a.$apply(function(){var c;if(m){for(var d=[],e=0;e<b.val.length;e++)c=o[b.val[e]],c&&d.push(c.id);n.assign(a,d)}else c=o[b.val],n.assign(a,c?c.id:null)})}),i.$render()})}}}]);